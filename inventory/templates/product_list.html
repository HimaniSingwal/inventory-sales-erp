{% extends 'base.html' %}

{% block title %}Product List{% endblock %}

{% block content %}

<h1 class="mb-4">ðŸ“¦ Product List</h1>
<div class="row text-center mb-4">
    <div class="col-md-3">
        <div class="card p-3 shadow-sm">
            <h6 class="text-muted">Total Products</h6>
            <h4>{{ total_products }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 shadow-sm">
            <h6 class="text-muted">Total Stock</h6>
            <h4>{{ total_stock }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 shadow-sm">
            <h6 class="text-muted">Inventory Value</h6>
            <h4>â‚¹{{ total_value }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 shadow-sm">
            <h6 class="text-muted">Low Stock Items</h6>
            <h4>{{ low_stock_items }}</h4>
        </div>
    </div>
</div>
<form method="GET" action="" class="mb-4 row g-2" style="max-width: 650px;">
    <div class="col-7">
        <input type="text" name="q" class="form-control"
               placeholder="Search by name or SKU..." value="{{ query }}">
    </div>

    <div class="col-3">
        <select name="sort" class="form-select">
            <option value="">Sort by...</option>
            <option value="name_asc"  {% if sort == 'name_asc' %}selected{% endif %}>Name A â†’ Z</option>
            <option value="name_desc" {% if sort == 'name_desc' %}selected{% endif %}>Name Z â†’ A</option>
            <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>Price Low â†’ High</option>
            <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>Price High â†’ Low</option>
            <option value="qty_asc"   {% if sort == 'qty_asc' %}selected{% endif %}>Qty Low â†’ High</option>
            <option value="qty_desc"  {% if sort == 'qty_desc' %}selected{% endif %}>Qty High â†’ Low</option>
        </select>
    </div>

    <div class="col-2">
        <button class="btn btn-primary w-100">Apply</button>
    </div>
</form>



<div class="mb-4">
    <a href="{% url 'add_product' %}" class="btn btn-primary btn-sm">
        + Add Product
    </a>
</div>

{% for p in products %}
<div class="card mb-3 p-3 shadow-sm">
    <h2 class="h5">{{ p.name }}</h2>
    <p><strong>SKU:</strong> {{ p.sku }}</p>
    <p><strong>Price:</strong> â‚¹{{ p.price }}</p>
    <p>
    <strong>Quantity:</strong> {{ p.quantity }}
    {% if p.quantity < 10 %}
        <span class="badge bg-danger ms-2">Low Stock</span>
    {% elif p.quantity < 20 %}
        <span class="badge bg-warning text-dark ms-2">Medium</span>
    {% else %}
        <span class="badge bg-success ms-2">Good</span>
    {% endif %}
</p>


    <div class="mt-2 d-flex gap-2">
        <a href="{% url 'adjust_stock' p.id %}" class="btn btn-sm btn-info">
        Adjust Stock
        </a>

        <a href="{% url 'edit_product' p.id %}" class="btn btn-sm btn-warning">
            Edit
        </a>

        <form action="{% url 'delete_product' p.id %}" method="POST">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-danger"
                    onclick="return confirm('Are you sure you want to delete this product?');">
                Delete
            </button>
        </form>
    </div>
</div>
{% empty %}
<p class="text-danger">No products found.</p>
{% endfor %}

{% endblock %}
